<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste de Tracking - AI Code Pro</title>
    <script src="https://unpkg.com/@supabase/supabase-js@2"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #1a1a1a;
            color: white;
        }
        .test-section {
            background: #2a2a2a;
            padding: 20px;
            margin: 20px 0;
            border-radius: 8px;
            border: 1px solid #444;
        }
        button {
            background: #0c83fe;
            color: white;
            border: none;
            padding: 10px 20px;
            margin: 5px;
            border-radius: 5px;
            cursor: pointer;
        }
        button:hover {
            background: #0a6fd9;
        }
        .result {
            background: #333;
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            font-family: monospace;
            font-size: 12px;
        }
        .success { border-left: 4px solid #00ff88; }
        .error { border-left: 4px solid #ff4444; }
        h1 { color: #0c83fe; }
        h2 { color: #00ff88; }
    </style>
</head>
<body>
    <h1>üß™ Teste de Tracking - AI Code Pro</h1>
    <p>Esta p√°gina testa todas as fun√ß√µes de tracking do sistema.</p>

    <div class="test-section">
        <h2>1. Teste aula_views</h2>
        <button onclick="testAulaView()">Testar Visualiza√ß√£o de Aula</button>
        <div id="aula-view-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>2. Teste qualified_leads</h2>
        <button onclick="testQualifiedLead()">Testar Lead Qualificado</button>
        <div id="qualified-lead-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>3. Teste aula_navigations</h2>
        <button onclick="testAulaNavigation()">Testar Navega√ß√£o entre Aulas</button>
        <div id="aula-navigation-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>4. Teste script_downloads</h2>
        <button onclick="testScriptDownload()">Testar Download de Script</button>
        <div id="script-download-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>5. Teste social_actions</h2>
        <button onclick="testSocialAction()">Testar A√ß√£o Social</button>
        <div id="social-action-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>6. Teste promo_banner_clicks</h2>
        <button onclick="testPromoBannerClick()">Testar Clique no Banner</button>
        <div id="promo-banner-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>7. Teste whatsapp_actions</h2>
        <button onclick="testWhatsAppAction()">Testar A√ß√£o WhatsApp</button>
        <div id="whatsapp-action-result" class="result"></div>
    </div>

    <div class="test-section">
        <h2>üöÄ Executar Todos os Testes</h2>
        <button onclick="runAllTests()" style="background: #00ff88; color: black; font-weight: bold;">Executar Todos os Testes</button>
        <div id="all-tests-result" class="result"></div>
    </div>

    <script>
        // Configura√ß√£o do Supabase
        const supabaseUrl = 'https://mnwqydirohyiflubxhfb.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im1ud3F5ZGlyb2h5aWZsdWJ4aGZiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjE2NzQyNjEsImV4cCI6MjAzNzI1MDI2MX0.yBhsKhgJBBtqJFNOJWBBxQJtl2aKqHWLJTMVCjVxLGU';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // Fun√ß√µes auxiliares
        function getSessionId() {
            let sessionId = localStorage.getItem('aicodepro_session_id');
            if (!sessionId) {
                sessionId = 'test_session_' + Math.random().toString(36).substring(2, 15);
                localStorage.setItem('aicodepro_session_id', sessionId);
            }
            return sessionId;
        }

        function getTestUtmParams() {
            return {
                utm_source: 'teste_tracking',
                utm_medium: 'sistema_teste',
                utm_campaign: 'validacao_tabelas',
                utm_content: 'teste_automatizado',
                utm_term: 'tracking_test'
            };
        }

        function showResult(elementId, success, message, data = null) {
            const element = document.getElementById(elementId);
            element.className = `result ${success ? 'success' : 'error'}`;
            element.innerHTML = `
                <strong>${success ? '‚úÖ SUCESSO' : '‚ùå ERRO'}:</strong> ${message}
                ${data ? `<br><pre>${JSON.stringify(data, null, 2)}</pre>` : ''}
            `;
        }

        // Teste 1: aula_views
        async function testAulaView() {
            try {
                const sessionId = getSessionId();
                const utmParams = getTestUtmParams();
                
                const viewData = {
                    email: 'teste_tracking@aicodepro.com',
                    phone: '+5511999999999',
                    session_id: sessionId,
                    aula_number: 1,
                    utm_source: utmParams.utm_source,
                    utm_medium: utmParams.utm_medium,
                    utm_campaign: utmParams.utm_campaign,
                    utm_content: utmParams.utm_content,
                    utm_term: utmParams.utm_term,
                    user_agent: navigator.userAgent,
                    referrer: document.referrer || 'teste_direto',
                    timestamp: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('aula_views')
                    .insert([viewData]);

                if (error) throw error;

                showResult('aula-view-result', true, 'Dados inseridos na tabela aula_views', viewData);
            } catch (error) {
                showResult('aula-view-result', false, error.message);
            }
        }

        // Teste 2: qualified_leads
        async function testQualifiedLead() {
            try {
                const sessionId = getSessionId();
                
                const leadData = {
                    email: 'teste_tracking@aicodepro.com',
                    phone: '+5511999999999',
                    session_id: sessionId,
                    source: 'teste_automatizado',
                    created_at: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('qualified_leads')
                    .insert([leadData]);

                if (error) throw error;

                showResult('qualified-lead-result', true, 'Dados inseridos na tabela qualified_leads', leadData);
            } catch (error) {
                showResult('qualified-lead-result', false, error.message);
            }
        }

        // Teste 3: aula_navigations
        async function testAulaNavigation() {
            try {
                const sessionId = getSessionId();
                const utmParams = getTestUtmParams();
                
                const navigationData = {
                    email: 'teste_tracking@aicodepro.com',
                    phone: '+5511999999999',
                    session_id: sessionId,
                    from_aula: 1,
                    to_aula: 2,
                    utm_source: utmParams.utm_source,
                    utm_medium: utmParams.utm_medium,
                    utm_campaign: utmParams.utm_campaign,
                    timestamp: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('aula_navigations')
                    .insert([navigationData]);

                if (error) throw error;

                showResult('aula-navigation-result', true, 'Dados inseridos na tabela aula_navigations', navigationData);
            } catch (error) {
                showResult('aula-navigation-result', false, error.message);
            }
        }

        // Teste 4: script_downloads
        async function testScriptDownload() {
            try {
                const sessionId = getSessionId();
                const utmParams = getTestUtmParams();
                
                const downloadData = {
                    email: 'teste_tracking@aicodepro.com',
                    phone: '+5511999999999',
                    session_id: sessionId,
                    aula_number: 1,
                    utm_source: utmParams.utm_source,
                    utm_medium: utmParams.utm_medium,
                    utm_campaign: utmParams.utm_campaign,
                    timestamp: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('script_downloads')
                    .insert([downloadData]);

                if (error) throw error;

                showResult('script-download-result', true, 'Dados inseridos na tabela script_downloads', downloadData);
            } catch (error) {
                showResult('script-download-result', false, error.message);
            }
        }

        // Teste 5: social_actions
        async function testSocialAction() {
            try {
                const sessionId = getSessionId();
                const utmParams = getTestUtmParams();
                
                const socialData = {
                    email: 'teste_tracking@aicodepro.com',
                    phone: '+5511999999999',
                    session_id: sessionId,
                    platform: 'instagram',
                    aula_number: 1,
                    utm_source: utmParams.utm_source,
                    utm_medium: utmParams.utm_medium,
                    utm_campaign: utmParams.utm_campaign,
                    timestamp: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('social_actions')
                    .insert([socialData]);

                if (error) throw error;

                showResult('social-action-result', true, 'Dados inseridos na tabela social_actions', socialData);
            } catch (error) {
                showResult('social-action-result', false, error.message);
            }
        }

        // Teste 6: promo_banner_clicks
        async function testPromoBannerClick() {
            try {
                const sessionId = getSessionId();
                const utmParams = getTestUtmParams();
                
                const clickData = {
                    session_id: sessionId,
                    email: 'teste_tracking@aicodepro.com',
                    phone: '+5511999999999',
                    utm_source: utmParams.utm_source,
                    utm_medium: utmParams.utm_medium,
                    utm_campaign: utmParams.utm_campaign,
                    utm_content: utmParams.utm_content,
                    utm_term: utmParams.utm_term,
                    user_agent: navigator.userAgent,
                    referrer: document.referrer || 'teste_direto',
                    current_page: '/teste-tracking',
                    timestamp: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('promo_banner_clicks')
                    .insert([clickData]);

                if (error) throw error;

                showResult('promo-banner-result', true, 'Dados inseridos na tabela promo_banner_clicks', clickData);
            } catch (error) {
                showResult('promo-banner-result', false, error.message);
            }
        }

        // Teste 7: whatsapp_actions
        async function testWhatsAppAction() {
            try {
                const sessionId = getSessionId();
                const utmParams = getTestUtmParams();
                
                const whatsappData = {
                    email: 'teste_tracking@aicodepro.com',
                    phone: '+5511999999999',
                    session_id: sessionId,
                    action_type: 'click',
                    aula_number: 1,
                    utm_source: utmParams.utm_source,
                    utm_medium: utmParams.utm_medium,
                    utm_campaign: utmParams.utm_campaign,
                    timestamp: new Date().toISOString()
                };

                const { data, error } = await supabase
                    .from('whatsapp_actions')
                    .insert([whatsappData]);

                if (error) throw error;

                showResult('whatsapp-action-result', true, 'Dados inseridos na tabela whatsapp_actions', whatsappData);
            } catch (error) {
                showResult('whatsapp-action-result', false, error.message);
            }
        }

        // Executar todos os testes
        async function runAllTests() {
            const allTestsElement = document.getElementById('all-tests-result');
            allTestsElement.innerHTML = '<strong>üöÄ Executando todos os testes...</strong>';
            
            const tests = [
                { name: 'aula_views', func: testAulaView },
                { name: 'qualified_leads', func: testQualifiedLead },
                { name: 'aula_navigations', func: testAulaNavigation },
                { name: 'script_downloads', func: testScriptDownload },
                { name: 'social_actions', func: testSocialAction },
                { name: 'promo_banner_clicks', func: testPromoBannerClick },
                { name: 'whatsapp_actions', func: testWhatsAppAction }
            ];

            let results = [];
            
            for (const test of tests) {
                try {
                    await test.func();
                    results.push(`‚úÖ ${test.name}: SUCESSO`);
                    await new Promise(resolve => setTimeout(resolve, 500)); // Delay entre testes
                } catch (error) {
                    results.push(`‚ùå ${test.name}: ERRO - ${error.message}`);
                }
            }

            allTestsElement.className = 'result success';
            allTestsElement.innerHTML = `
                <strong>üéâ Todos os testes executados!</strong><br>
                ${results.join('<br>')}
                <br><br>
                <strong>üìä Verificar no Supabase:</strong><br>
                Acesse o painel do Supabase e verifique se os dados de teste foram inseridos em cada tabela.
            `;
        }

        // Inicializar p√°gina
        window.onload = function() {
            console.log('P√°gina de teste carregada. Session ID:', getSessionId());
        };
    </script>
</body>
</html>
